---
import { getCollection, type CollectionEntry } from "astro:content";
import { getReadingTime } from "../../utils/readingTime";
import Layout from "../../layouts/Layout.astro";

const base = import.meta.env.BASE_URL || "/";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post: CollectionEntry<"blog">) => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

interface Props {
    post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { Content } = await post.render();

const plainText = post.body.replace(/<[^>]*>/g, "").trim();
const readingTime = getReadingTime(plainText);
---

<Layout>
    <article class="blog-post">
        <header class="post-header">
            <a class="goback" href={base + "blog"}>Go Back</a>
            <h1 class="post-title">{post.data.title}</h1>
            <p class="post-description">{post.data.description}</p>
            {
                post.data.image && (
                    <img
                        src={post.data.image}
                        alt={post.data.title || "Post thumbnail"}
                        width="800"
                        height="450"
                        loading="eager"
                        decoding="async"
                        class="post-thumbnail"
                    />
                )
            }

            <div class="post-meta">
                <span class="author">By {post.data.author}</span>
                <span class="date">
                    {
                        post.data.date.toLocaleDateString("en-US", {
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                        })
                    }
                </span>
                <span class="reading-time">{readingTime}</span>
            </div>

            {
                post.data.tags && post.data.tags.length > 0 && (
                    <div class="tags">
                        {post.data.tags.map((tag: string) => (
                            <a
                                href={`${base}blog/tag/${tag.toLowerCase()}`}
                                class="tag"
                            >
                                #{tag}
                            </a>
                        ))}
                    </div>
                )
            }
        </header>

        <div class="post-content">
            <Content />
        </div>
    </article>
</Layout>

<style>
    .blog-post {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem 0;
    }

    .post-header {
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #333;
    }

    .post-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #fff;
        line-height: 1.2;
        background: linear-gradient(83.21deg, #3245ff 0%, #bc52ee 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .post-description {
        font-size: 1.1rem;
        color: #b0b0b0;
        margin-bottom: 1.5rem;
        font-style: italic;
    }

    .post-meta {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        font-size: 0.9rem;
        color: #888;
        margin-bottom: 1rem;
    }

    .author,
    .date,
    .reading-time {
        display: flex;
        align-items: center;
    }

    .tags {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .tag {
        display: inline-block;
        padding: 0.4rem 0.8rem;
        background-color: #222;
        border: 1px solid #333;
        border-radius: 20px;
        color: #3245ff;
        text-decoration: none;
        font-size: 0.85rem;
        transition: all 0.3s;
    }

    .tag:hover {
        background-color: #3245ff;
        color: #fff;
        border-color: #3245ff;
    }

    .post-content {
        font-size: 1.05rem;
        line-height: 1.8;
        margin-bottom: 3rem;
    }

    .goback {
        text-decoration: underline;
        color: #3245ff;
        transition: 0.2s all;
    }

    .post-thumbnail {
        width: 100%;
        height: 450px; /* or whatever height you prefer */
        object-fit: cover; /* crops to fill the space without distortion */
        object-position: center; /* centers the crop */
        border-radius: 12px;
        margin-bottom: 1.5rem;
        display: block;
    }

    .goback:hover {
        color: #5bbdff;
    }

    :global(.post-content h2) {
        font-size: 1.8rem;
        margin: 2rem 0 1rem 0;
        color: #fff;
    }

    :global(.post-content h3) {
        font-size: 1.3rem;
        margin: 1.5rem 0 0.75rem 0;
        color: #ddd;
    }

    :global(.post-content p) {
        margin-bottom: 1rem;
        color: #c0c0c0;
    }

    :global(.post-content a) {
        color: #3245ff;
        text-decoration: none;
        border-bottom: 1px solid #3245ff;
        transition: color 0.3s;
    }

    :global(.post-content a:hover) {
        color: #bc52ee;
        border-bottom-color: #bc52ee;
    }

    :global(.post-content code) {
        background-color: #222;
        color: #e0e0e0;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
        font-size: 0.9em;
    }

    :global(.post-content pre) {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 1rem;
        overflow-x: auto;
        margin: 1.5rem 0;
    }

    :global(.post-content pre code) {
        background: none;
        padding: 0;
        color: #e0e0e0;
    }

    :global(.post-content ul),
    :global(.post-content ol) {
        margin: 1rem 0;
        padding-left: 2rem;
    }

    :global(.post-content li) {
        margin-bottom: 0.5rem;
        color: #c0c0c0;
    }

    :global(.post-content blockquote) {
        border-left: 4px solid #3245ff;
        padding-left: 1rem;
        margin: 1.5rem 0;
        color: #999;
        font-style: italic;
    }

    .post-footer {
        padding-top: 2rem;
        border-top: 1px solid #333;
    }

    .author-bio {
        background-color: #1a1a1a;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #333;
    }

    .author-bio h3 {
        margin-top: 0;
        color: #fff;
    }

    .author-bio p {
        color: #b0b0b0;
        margin: 0.5rem 0 0 0;
    }

    @media (max-width: 768px) {
        .blog-post {
            padding: 1rem 0;
        }

        .post-title {
            font-size: 1.8rem;
        }

        .post-description {
            font-size: 1rem;
        }

        .post-meta {
            gap: 1rem;
            font-size: 0.85rem;
        }

        .post-content {
            font-size: 1rem;
        }

        :global(.post-content h2) {
            font-size: 1.5rem;
        }

        :global(.post-content h3) {
            font-size: 1.1rem;
        }
    }
</style>
